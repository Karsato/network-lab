services:
  # Nodo Cliente: Representa la red externa
  cliente:
    image: debian:bookworm-slim
    container_name: network-lab-cliente-1
    privileged: true
    networks:
      red_externa:
        ipv4_address: 10.0.1.10
    tty: true
    stdin_open: true
    command: >
      sh -c "apt update && apt install -y iproute2 iputils-ping curl && 
             ip route del default && 
             ip route add default via 10.0.1.2 && 
             tail -f /dev/null"

  # Nodo Firewall: El router/filtro central
  firewall:
    build:
      context: .
      dockerfile: Dockerfile.firewall
    container_name: network-lab-firewall-1
    privileged: true
    sysctls:
      - net.ipv4.ip_forward=1
    networks:
      red_externa:
        ipv4_address: 10.0.1.2
      red_interna:
        ipv4_address: 192.168.1.2
    tty: true
    stdin_open: true
    command: tail -f /dev/null

  # Nodo Servidor: La red interna protegida
  servidor:
    image: debian:bookworm-slim
    container_name: network-lab-servidor-1
    privileged: true
    networks:
      red_interna:
        ipv4_address: 192.168.1.10
    tty: true
    stdin_open: true
    command: >
      sh -c "apt update && apt install -y iproute2 iputils-ping nginx && 
             ip route del default && 
             ip route add default via 192.168.1.2 && 
             nginx -g 'daemon off;'"

networks:
  red_externa:
    ipam:
      config:
        - subnet: 10.0.1.0/24
  red_interna:
    ipam:
      config:
        - subnet: 192.168.1.0/24
